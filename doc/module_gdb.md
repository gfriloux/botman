# GDB Module

<span class="label label-success">Alfred</span> <span class="label label-primary">Botman</span>

## Description

This module serves the goal of sending backtraces of crashing programs, as they crash.\n
\n
Every time a botman finds a new coredump, it will extract its backtrace using gdb,
will send it to alfred, which will then dispatch this backtrace to every member of its `heroes` list.

## Configuration

### Alfred

You need to create a configuration file (`/etc/gotham/modules.conf.d/gdb.conf`)
<pre>
{
   "heroes":   [
      "dev1@botnet.master.com",
      "dev2@botnet.master.com"
   ]
}
</pre>
You dont have to add `heroes` at this point, they can be added later using
commands exported by the module.

### Botman

You need to tell the `GDB module` which directory to watch for coredumps.\n
Create the file `/etc/gotham/modules.conf.d/gdb.conf` :
<pre>
{
   "dir" : "/var/dumps/"
}
</pre>
\n
You need to tell the `GDB module` how to invoc GDB to extract the backtrace.\n
Create the file `/usr/share/gotham/modules.d/gdb/command` and put :
<pre>
thread apply all backtrace full
</pre>
\n\n
## Example use

### View the list of `heroes` that will receive backtraces

<span class="label label-success">Alfred</span>
> <span style="color:blue">(12:00:19) guillaume.friloux@botnet.master.com:</span> .gdb\n
> <span style="color:red">(12:00:19) Alfred Pennyworth:</span>\n
> List of heroes :\n
> &nbsp;&nbsp;&nbsp;guillaume.friloux@botnet.master.com\n
> &nbsp;&nbsp;&nbsp;dev2@botnet.master.com\n
\n

### Add a user to `heroes` list

<span class="label label-success">Alfred</span>
> <span style="color:blue">(13:56:02) guillaume.friloux@botnet.master.com:</span> .gdb add dev3@botnet.master.com\n
> <span style="color:red">(13:56:02) Alfred Pennyworth:</span> A new nightwatcher has arise\n
The user you are adding must already be in `Alfred`'s contact list.
\n

### Remove a user from `heroes` list

<span class="label label-success">Alfred</span>
> <span style="color:blue">(13:56:26) guillaume.friloux@botnet.master.com:</span> .gdb del dev3@botnet.master.com\n
> <span style="color:red">(13:56:26) Alfred Pennyworth:</span> Rest in pieces
\n

### Reception of a coredump

<span class="label label-success">Alfred</span>\n
This is not a command to run, this is an event message sent to you.
> <span style="color:red">(11:16:58) Alfred Pennyworth:</span> Received backtrace from botman-xxx@botnet.master.com (botman-xxx) :\n
> Coredump file : /var/dumps/hello.1.core\n
> Core was generated by `hello'.\n
> Program terminated with signal 11, Segmentation fault.\n
> #0  0x0000000802446f8b in strlen () from /lib/libc.so.7\n
> [New Thread 805c06400 (LWP 100410/xxxxx)]\n
> Thread 1 (Thread 805c06400 (LWP 100410/xxxxx)):\n
> #0  0x0000000802446f8b in strlen () from /lib/libc.so.7\n
> No symbol table info available.\n
> #1  0x000000080243c505 in vfprintf_l () from /lib/libc.so.7\n
> No symbol table info available.\n
> #2  0x000000080243dfa7 in vfprintf () from /lib/libc.so.7\n
> No symbol table info available.\n
> ...\n
> #17 0x0000000801176cd5 in azy_server_run (server=&lt;value optimized out&gt;)\n
>     at src/lib/azy/azy_server.c:310\n

Here, `Alfred` sends us a backtrace that he received from `botman-xxx@botnet.master.com`.\n
The coredump file can be found on the server under the path `/var/dumps/hello.1.core`.\n
The crashing process name is `hello`, and did a segmentation fault.\n
Following that is the backtrace of the app, that should help us to track down the issue
(backtrace intentionnally cut for the example).
\n

### List coredumps

<span class="label label-primary">Botman</span>
> <span style="color:blue">(30/07/2015 14:07:33) guillaume.friloux@botnet.master.com:</span> .gdb list\n
> <span style="color:red">(14:07:33) botman-xxx:</span> \n
> List of coredumps :\n
> <table bordel=0 width=80%>
> <tr><td>/var/dumps/xxxxx.9186.core</td><td>18808832</td><td>2015/07/17 10:23:13</td></tr>
> <tr><td>/var/dumps/yyyyyy.57024.core</td><td>14557184</td><td>2015/07/17 10:23:22</td></tr>
> <tr><td>/var/dumps/xxxxx.58349.core</td><td>13959168</td><td>2015/07/17 10:29:06</td></tr>
> <tr><td>/var/dumps/xxxxx.58469.core</td><td>18677760</td><td>2015/07/17 11:07:50</td></tr>
> <tr><td>/var/dumps/xxxxx.61550.core</td><td>18890752</td><td>2015/07/17 14:52:41</td></tr>
> <tr><td>/var/dumps/xxxxx.65589.core</td><td>13963264</td><td>2015/07/17 15:23:42</td></tr>
> <tr><td>/var/dumps/xxxxx.71316.core</td><td>13967360</td><td>2015/07/17 16:06:41</td></tr>
> </table>
\n

### Delete coredumps

<span class="label label-primary">Botman</span>
> <span style="color:blue">(14:57:34) guillaume.friloux@botnet.master.com:</span> .gdb delete xxxxx.58349.core\n
> <span style="color:red">(14:57:34) botman-xxxx:</span>\n
> Deleted coredumps :\n
> &nbsp;&nbsp;&nbsp;/var/dumps/xxxxx.58349.core

This command allows the use of wildcards to delete multiple coredumps at once :
> <span style="color:blue">(15:59:41) guillaume.friloux@botnet.master.com:</span> .gdb delete xxxxx.*\n
> <span style="color:red">(15:59:41) botman-xxxx: </span>\n
> Deleted coredumps :\n
> &nbsp;&nbsp;&nbsp;/var/dumps/xxxxx.9186.core\n
> &nbsp;&nbsp;&nbsp;/var/dumps/xxxxx.58469.core\n
> &nbsp;&nbsp;&nbsp;/var/dumps/xxxxx.61550.core\n
> &nbsp;&nbsp;&nbsp;/var/dumps/xxxxx.65589.core\n
> &nbsp;&nbsp;&nbsp;/var/dumps/xxxxx.71316.core\n
\n

### Get the backtrace from a coredump

<span class="label label-primary">Botman</span>
> <span style="color:blue">(16:05:25) guillaume.friloux@botnet.master.com:</span> .gdb fetch xxxxx.58587.core\n
> <span style="color:red">(16:05:26) botman-xxxx:</span> Coredump file : /var/dumps/xxxxx.58587.core\n
> Core was generated by `xxxxx'.\n
> Program terminated with signal 11, Segmentation fault.\n
> #0  0x000000080312ab7a in select () from /lib/libc.so.7\n
> [New Thread 805c06400 (LWP 100158/xxxxx)]\n
> \n
> Thread 1 (Thread 805c06400 (LWP 100158/xxxxx)):\n
> #0  0x000000080312ab7a in select () from /lib/libc.so.7\n
> No symbol table info available.\n
> #1  0x0000000802dccb32 in select () from /lib/libthr.so.3\n
> No symbol table info available.\n
> #2  0x0000000802518c52 in _ecore_main_select (timeout=29.945528479060158)\n
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at ecore_main.c:1480\n
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tv = {tv_sec = 29, tv_usec = 945528}\n
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t = (struct timeval *) 0x7fffffffebc0\n
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rfds = {__fds_bits = {11920, 0 <repeats 15 times>}}\n
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wfds = {__fds_bits = {0 <repeats 16 times>}}\n
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exfds = {__fds_bits = {0 <repeats 16 times>}}\n
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fdh = (Ecore_Fd_Handler *) 0x0\n
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l = (Eina_List *) 0x0\n
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_fd = 13\n
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret = 45709720\n
> #3  0x0000000802517728 in _ecore_main_loop_iterate_internal (once_only=0)\n
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at ecore_main.c:1908\n
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next_time = 29.945528479060158\n
> #4  0x00000008025178c4 in ecore_main_loop_begin () at ecore_main.c:960\n
> No locals.\n
> #5  0x0000000801572d75 in azy_server_run (server=&lt;value optimized out&gt;)\n
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at src/lib/azy/azy_server.c:314\n

\n
